{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/schemas/risk_note.schema.json",
  "title": "Risk Note v1.0",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "risk_note": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "identity",
        "scope",
        "claim",
        "evidence",
        "uncertainty",
        "triage",
        "controls",
        "next_investigation"
      ],
      "properties": {
        "identity": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "id",
            "version",
            "created",
            "author"
          ],
          "properties": {
            "id": {
              "type": "string",
              "minLength": 1
            },
            "version": {
              "type": "string",
              "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[0-9A-Za-z-.]+)?(?:\\+[0-9A-Za-z-.]+)?$"
            },
            "created": {
              "type": "string",
              "format": "date-time"
            },
            "author": {
              "type": "string",
              "minLength": 1
            },
            "change_log": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": [
                  "timestamp",
                  "author",
                  "description"
                ],
                "properties": {
                  "timestamp": {
                    "type": "string",
                    "format": "date-time"
                  },
                  "author": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "scope": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "operating_conditions",
            "input_distribution",
            "temporal_validity"
          ],
          "properties": {
            "operating_conditions": {
              "type": "string"
            },
            "input_distribution": {
              "type": "string"
            },
            "temporal_validity": {
              "type": "string",
              "pattern": "^P(?=.)((\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?)(T(\\d+H)?(\\d+M)?(\\d+S)?)?$"
            },
            "exclusions": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "claim": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "hazard_class",
            "threshold",
            "credible_interval",
            "shift_budget",
            "failure_criteria"
          ],
          "properties": {
            "hazard_class": {
              "type": "string",
              "enum": [
                "OOD",
                "AdversarialManipulation",
                "CapabilityEscalation",
                "UnsafeToolUse",
                "PrivacyBreach",
                "ValueMisalignment",
                "AutonomyLoss",
                "SystemicFailure"
              ]
            },
            "threshold": {
              "type": "number"
            },
            "credible_interval": {
              "type": "array",
              "minItems": 2,
              "maxItems": 2,
              "items": {
                "type": "number"
              }
            },
            "shift_budget": {
              "type": "number",
              "minimum": 0
            },
            "failure_criteria": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "string"
              }
            }
          }
        },
        "evidence": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "sources",
            "methodology"
          ],
          "properties": {
            "sources": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": [
                  "id",
                  "title",
                  "uri",
                  "type",
                  "created"
                ],
                "properties": {
                  "id": {
                    "type": "string"
                  },
                  "title": {
                    "type": "string"
                  },
                  "uri": {
                    "type": "string"
                  },
                  "type": {
                    "type": "string",
                    "enum": [
                      "dataset",
                      "experiment",
                      "report",
                      "artifact",
                      "log",
                      "proof",
                      "simulation"
                    ]
                  },
                  "created": {
                    "type": "string",
                    "format": "date-time"
                  },
                  "sha256": {
                    "type": "string",
                    "pattern": "^[a-fA-F0-9]{64}$"
                  },
                  "provenance": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                      "producer": {
                        "type": "string"
                      },
                      "method": {
                        "type": "string"
                      },
                      "signed_by": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            },
            "methodology": {
              "type": "string"
            },
            "provenance": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "ingested_by": {
                  "type": "string"
                },
                "ingested_at": {
                  "type": "string",
                  "format": "date-time"
                },
                "chain_of_custody": {
                  "type": "string"
                }
              }
            },
            "staleness_threshold": {
              "type": "string",
              "pattern": "^P(?=.)((\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?)(T(\\d+H)?(\\d+M)?(\\d+S)?)?$"
            }
          }
        },
        "uncertainty": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "entries"
          ],
          "properties": {
            "entries": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": [
                  "id",
                  "type",
                  "location",
                  "contribution",
                  "description"
                ],
                "properties": {
                  "id": {
                    "type": "string"
                  },
                  "type": {
                    "type": "string",
                    "enum": [
                      "aleatory",
                      "epistemic"
                    ]
                  },
                  "location": {
                    "type": "string",
                    "enum": [
                      "data",
                      "model",
                      "tooling",
                      "human",
                      "deployment"
                    ]
                  },
                  "contribution": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1
                  },
                  "description": {
                    "type": "string"
                  },
                  "resolution_lever": {
                    "type": "string"
                  },
                  "cost_estimate_hours": {
                    "type": "number",
                    "minimum": 0
                  },
                  "proposed_experiment": {
                    "type": "string"
                  }
                }
              }
            },
            "total_contribution": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "resolution_priorities": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "triage": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "severity",
            "exploitability",
            "reversibility",
            "posture"
          ],
          "properties": {
            "severity": {
              "type": "integer",
              "minimum": 1,
              "maximum": 5
            },
            "exploitability": {
              "type": "integer",
              "minimum": 1,
              "maximum": 5
            },
            "reversibility": {
              "type": "integer",
              "minimum": 1,
              "maximum": 5
            },
            "posture": {
              "type": "string",
              "enum": [
                "red",
                "amber",
                "green"
              ]
            },
            "deviation_notes": {
              "type": "string"
            }
          }
        },
        "controls": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "prevent": {
              "$ref": "#/$defs/control_list"
            },
            "detect": {
              "$ref": "#/$defs/control_list"
            },
            "contain": {
              "$ref": "#/$defs/control_list"
            },
            "recover": {
              "$ref": "#/$defs/control_list"
            }
          }
        },
        "next_investigation": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "experiment",
            "evoi_score"
          ],
          "properties": {
            "experiment": {
              "type": "string"
            },
            "evoi_score": {
              "type": "number",
              "minimum": 0
            },
            "resource_estimate": {
              "type": "string",
              "pattern": "^P(?=.)((\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?)(T(\\d+H)?(\\d+M)?(\\d+S)?)?$"
            },
            "decision_impact": {
              "type": "string"
            },
            "success_criteria": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    }
  },
  "$defs": {
    "control_list": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "id",
          "description",
          "owner",
          "status"
        ],
        "properties": {
          "id": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "owner": {
            "type": "string"
          },
          "metric": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": [
              "proposed",
              "implemented",
              "validated",
              "deprecated"
            ]
          },
          "activation_posture": {
            "type": "string",
            "enum": [
              "red",
              "amber",
              "green"
            ]
          },
          "effectiveness_evidence": {
            "type": "string"
          }
        }
      }
    }
  }
}
